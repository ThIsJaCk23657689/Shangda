!function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=157)}({0:function(t,e,a){"use strict";function r(t,e,a,r,i,s,n,o){var d,l="function"==typeof t?t.options:t;if(e&&(l.render=e,l.staticRenderFns=a,l._compiled=!0),r&&(l.functional=!0),s&&(l._scopeId="data-v-"+s),n?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},l._ssrRegister=d):i&&(d=o?function(){i.call(this,(l.functional?this.parent:this).$root.$options.shadowRoot)}:i),d)if(l.functional){l._injectStyles=d;var u=l.render;l.render=function(t,e){return d.call(e),u(t,e)}}else{var c=l.beforeCreate;l.beforeCreate=c?[].concat(c,d):[d]}return{exports:t,options:l}}a.d(e,"a",(function(){return r}))},157:function(t,e,a){t.exports=a(158)},158:function(t,e,a){Vue.component("produces-update-form",a(222).default),Vue.component("produces-materials-detail",a(60).default),Vue.component("produces-products-detail",a(61).default);new Vue({el:"#Produces",data:function(){return{products:[],all_products:[],products_disabled:[],materials:[],all_materials:[],materials_disabled:[],produce:[]}},methods:{refreshMaterials:function(t){if(this.materials=this.all_materials,"add"==t.type)this.materials_disabled.push({id:this.materials[t.id].id,name:this.materials[t.id].name});else{for(var e,a=0;a<this.materials_disabled.length;a++)if(this.materials_disabled[a].id==t.id){e=a;break}this.materials_disabled.splice(e,1)}this.materials=[];for(var r=0;r<this.all_materials.length;r++){for(var i=!0,s=0;s<this.materials_disabled.length;s++)this.all_materials[r].id==this.materials_disabled[s].id&&(i=!1);i&&this.materials.push(this.all_materials[r])}},refreshProducts:function(t){if(this.products=this.all_products,"add"==t.type)this.products_disabled.push({id:this.products[t.id].id,name:this.products[t.id].name});else{for(var e,a=0;a<this.products_disabled.length;a++)if(this.products_disabled[a].id==t.id){e=a;break}this.products_disabled.splice(e,1)}this.products=[];for(var r=0;r<this.all_products.length;r++){for(var i=!0,s=0;s<this.products_disabled.length;s++)this.all_products[r].id==this.products_disabled[s].id&&(i=!1);i&&this.products.push(this.all_products[r])}}},created:function(){var t=this;$.showLoadingModal();var e=$("#getProductsName").text();axios.get(e).then((function(e){t.products=e.data,t.all_products=t.products}));var a=$("#getMeterialsName").text();axios.get(a).then((function(e){t.materials=e.data,t.all_materials=t.materials}));var r=$("#getProducesData").text();axios.get(r).then((function(e){t.produce=e.data.produce;var a=t.$refs.ProduceUpdateForm;a.$refs.ProducesMaterialsDetail.setDetails(t.produce.produce_details),a.$refs.ProducesProductsDetail.setDetails(t.produce.produce_products),$.closeModal()}))},mounted:function(){}})},222:function(t,e,a){"use strict";a.r(e);var r={props:["products","materials","produce"],data:function(){return{getProducesIndex:$("#getProducesIndex").text(),updateProduce:$("#updateProduce").text()}},methods:{refreshMaterials:function(t){this.$emit("refresh-materials",t)},refreshProducts:function(t){this.$emit("refresh-products",t)},updateProduceForm:function(t){var e=this;if(0==this.$refs.ProducesMaterialsDetail.details.length)return $.showWarningModal("不可沒有所消耗的原物料!"),!1;if(0==this.$refs.ProducesProductsDetail.details.length)return $.showWarningModal("不可沒有所產出的商品!"),!1;if(!this.checkNoZeroQty(this.$refs.ProducesMaterialsDetail.details)||!this.checkNoZeroQty(this.$refs.ProducesProductsDetail.details))return $.showWarningModal("不得有0投入的原物料或者0產出商品的存在！"),!1;$.showLoadingModal();var a=this.updateProduce,r=$(t.target).serialize();axios.patch(a,r).then((function(t){$("#m_produceID").val(t.data.produce_id),$("#p_produceID").val(t.data.produce_id);var a=$("#updateProduceDetail").text(),r={produce_id:t.data.produce_id,material_details:e.$refs.ProducesMaterialsDetail.details,product_details:e.$refs.ProducesProductsDetail.details};axios.patch(a,r).then((function(t){$.showSuccessModal(t.data.message,t.data.url)})).catch((function(t){console.error("新增庫存細項時發生錯誤，錯誤訊息："+t),$.showErrorModal(t)}))})).catch((function(t){console.error("新增商品庫存時發生錯誤，錯誤訊息："+t),$.showErrorModal(t)}))},checkNoZeroQty:function(t){for(var e=!0,a=0;a<t.length;a++)if(0==t[a].quantity){e=!1;break}return e}},created:function(){},mounted:function(){}},i=a(0),s=Object(i.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-md-10"},[e("form",{attrs:{id:"ProduceUpdateForm",method:"POST",action:"#"},on:{submit:function(e){return e.preventDefault(),t.updateProduceForm.apply(null,arguments)}}},[t._m(0),t._v(" "),e("produces-materials-detail",{ref:"ProducesMaterialsDetail",attrs:{materials:t.materials},on:{"refresh-materials":t.refreshMaterials}}),t._v(" "),e("hr"),t._v(" "),t._m(1),t._v(" "),e("produces-products-detail",{ref:"ProducesProductsDetail",attrs:{products:t.products},on:{"refresh-products":t.refreshProducts}}),t._v(" "),e("hr"),t._v(" "),e("div",{staticClass:"form-group row justify-content-center"},[e("div",{staticClass:"col-md-8"},[e("button",{staticClass:"btn btn-block btn-success",attrs:{type:"submit"}},[t._v("\r\n                        確認修改\r\n                    ")]),t._v(" "),e("a",{staticClass:"btn btn-block btn-danger",attrs:{href:t.getProducesIndex}},[t._v("\r\n                        返回上一頁\r\n                    ")])])])],1)])])}),[function(){var t=this._self._c;return t("div",{staticClass:"row",attrs:{id:"step1"}},[t("div",{staticClass:"col-md-12 mb-2"},[t("h4",[this._v("1. 投入原物料")]),this._v(" "),t("small",[this._v("請輸入投入原料數量")])])])},function(){var t=this._self._c;return t("div",{staticClass:"row",attrs:{id:"step2"}},[t("div",{staticClass:"col-md-12 mb-2"},[t("h4",[this._v("2. 產出商品")]),this._v(" "),t("small",[this._v("請輸入產出商品數量")])])])}],!1,null,null,null);e.default=s.exports},60:function(t,e,a){"use strict";a.r(e);var r={props:["materials"],data:function(){return{details:[],current_material:[]}},methods:{getMaterialData:function(){var t=this,e=$("#material_id").val();if(0!=e){var a=$("#getMeterialInfo").html();$("#addMaterialBtn").attr("disabled",!0),axios.post(a,{id:e}).then((function(e){t.current_material=e.data,$("#addMaterialBtn").attr("disabled",!1)}))}else this.current_material=[]},addDetail:function(){var t=$("#material_id").val();0==t?$.showWarningModal("請先選擇原物料!"):(this.$emit("refresh-materials",{id:t-1,type:"add"}),0!=this.current_material.length?(this.details.push({count:this.details.length,material:{id:this.current_material.id,name:this.current_material.name,unit:this.current_material.unit,showUnit:this.current_material.showUnit,showSafeQty:this.current_material.showSafeQty},currentQty:this.current_material.showStock,quantity:0,afterQty:this.current_material.showStock}),this.current_material=[]):$.showWarningModal("請選擇原物料"))},deleteDetail:function(t){this.details.splice(t,1),this.$emit("refresh-materials",{id:$("#materialID_"+(t+1)).val(),type:"deleted"})},calculateAfterQty:function(t){var e,a,r=parseFloat($("#currentQty_"+t).val());$.isFloatOrInt($("#quantity_"+t))?(e=parseFloat($("#quantity_"+t).val()))>r?(console.log(e>r),$.showWarningModal("原物料庫存不足！"),$("#quantity_"+t).val(0),a=parseFloat(Math.round(1e4*r)/1e4),this.details[t-1].quantity=0):(a=parseFloat(Math.round(1e4*(r-e))/1e4),this.details[t-1].quantity=e):($("#quantity_"+t).val(0),a=parseFloat(Math.round(1e4*r)/1e4),this.details[t-1].quantity=0),$("#afterQty_"+t).val(a),this.details[t-1].afterQty=a},setDetails:function(t){this.details=t}},created:function(){},mounted:function(){}},i=a(0),s=Object(i.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-md-12"},[e("form",{attrs:{id:"ProduceMaterialsDetailForm",method:"POST",action:"#"}},[e("input",{attrs:{type:"hidden",id:"m_produceID",name:"produce_id",value:""}}),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6 mb-2"},[e("select",{staticClass:"form-control",attrs:{id:"material_id"},on:{change:t.getMaterialData}},[e("option",{attrs:{value:"0"}},[t._v("請選擇...")]),t._v(" "),t._l(t.materials,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(t._s(a.name))])}))],2)]),t._v(" "),e("div",{staticClass:"col-md-6"},[e("button",{staticClass:"btn btn-md btn-success",attrs:{id:"addMaterialBtn",type:"button"},on:{click:t.addDetail}},[t._v("新增至細項")])])]),t._v(" "),e("table",{staticClass:"table table-bordered",attrs:{width:"100%",cellspacing:"0"}},[t._m(0),t._v(" "),e("tbody",t._l(t.details,(function(a,r){return e("tr",{key:r},[e("td",[t._v(t._s(r+1))]),t._v(" "),e("td",[t._v("\r\n                            "+t._s(a.material.name)),e("br"),t._v(" "),a.material.safeQuantity>a.currentQty-a.quantity?e("span",{staticClass:"badge badge-warning"},[t._v("庫存警告")]):t._e(),t._v(" "),e("input",{attrs:{type:"hidden",id:"materialID_"+(r+1),name:"details["+(r+1)+"][material_id]"},domProps:{value:a.material.id}})]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"currentQty_"+(r+1),type:"text",disabled:""},domProps:{value:a.currentQty}}),t._v(" "),e("span",[t._v(t._s(a.material.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"quantity_"+(r+1),type:"text",name:"details["+(r+1)+"][quantity]"},domProps:{value:a.quantity},on:{change:function(e){return t.calculateAfterQty(r+1)}}}),t._v(" "),e("span",[t._v(t._s(a.material.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"afterQty_"+(r+1),type:"text",disabled:""},domProps:{value:a.afterQty}}),t._v(" "),e("span",[t._v(t._s(a.material.showUnit))])]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-md btn-danger",attrs:{type:"button"},on:{click:function(e){return t.deleteDetail(r)}}},[e("i",{staticClass:"far fa-trash-alt"})])])])})),0)])])])])}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("編號")]),t._v(" "),e("th",[t._v("原物料")]),t._v(" "),e("th",[t._v("消耗前存量")]),t._v(" "),e("th",[t._v("消耗量")]),t._v(" "),e("th",[t._v("剩餘量")]),t._v(" "),e("th",[t._v("操作")])])])}],!1,null,null,null);e.default=s.exports},61:function(t,e,a){"use strict";a.r(e);var r={props:["products"],data:function(){return{details:[],current_product:[]}},methods:{getProductData:function(){var t=this,e=$("#product_id").val();if(0!=e){var a=$("#getProductsInfo").html();$("#addProductBtn").attr("disabled",!0),axios.post(a,{id:e}).then((function(e){t.current_product=e.data,$("#addProductBtn").attr("disabled",!1)}))}else this.current_product=[]},addDetail:function(){var t=$("#product_id").val();0==t?$.showWarningModal("請先選擇商品!"):(this.$emit("refresh-products",{id:t-1,type:"add"}),0!=this.current_product.length?(this.details.push({count:this.details.length,product:{id:this.current_product.id,name:this.current_product.name,unit:this.current_product.unit,showUnit:this.current_product.showUnit,safeQuantity:this.current_product.safeQuantity},currentQty:this.current_product.quantity,quantity:0,afterQty:this.current_product.quantity}),this.current_product=[]):$.showWarningModal("請先選擇商品!"))},deleteDetail:function(t){this.details.splice(t,1),this.$emit("refresh-products",{id:$("#productID_"+(t+1)).val(),type:"deleted"})},calculateAfterQty:function(t){var e,a,r=parseFloat($("#p_currentQty_"+t).val());$.isFloatOrInt($("#p_quantity_"+t))?(e=parseFloat($("#p_quantity_"+t).val()),a=parseFloat(Math.round(1e4*(r+e))/1e4),this.details[t-1].quantity=e):($("#p_quantity_"+t).val(0),a=parseFloat(Math.round(1e4*r)/1e4),this.details[t-1].quantity=0),$("#p_afterQty_"+t).val(a),this.details[t-1].afterQty=a},setDetails:function(t){this.details=t}},created:function(){},mounted:function(){}},i=a(0),s=Object(i.a)(r,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-md-12"},[e("form",{attrs:{id:"ProduceProductsDetailForm",method:"POST",action:"#"}},[e("input",{attrs:{type:"hidden",id:"p_produceID",name:"produce_id",value:""}}),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6 mb-2"},[e("select",{staticClass:"form-control",attrs:{id:"product_id"},on:{change:t.getProductData}},[e("option",{attrs:{value:"0"}},[t._v("請選擇...")]),t._v(" "),t._l(t.products,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(t._s(a.name))])}))],2)]),t._v(" "),e("div",{staticClass:"col-md-6"},[e("button",{staticClass:"btn btn-md btn-success",attrs:{id:"addProductBtn",type:"button"},on:{click:t.addDetail}},[t._v("新增至細項")])])]),t._v(" "),e("table",{staticClass:"table table-bordered",attrs:{width:"100%",cellspacing:"0"}},[t._m(0),t._v(" "),e("tbody",t._l(t.details,(function(a,r){return e("tr",{key:r},[e("td",[t._v(t._s(r+1))]),t._v(" "),e("td",[t._v("\r\n                            "+t._s(a.product.name)),e("br"),t._v(" "),a.product.safeQuantity>a.currentQty+a.quantity?e("span",{staticClass:"badge badge-warning"},[t._v("庫存警告")]):t._e(),t._v(" "),e("input",{attrs:{type:"hidden",id:"p_productID_"+(r+1),name:"details["+(r+1)+"][product_id]"},domProps:{value:a.product.id}})]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"p_currentQty_"+(r+1),type:"text",disabled:""},domProps:{value:a.currentQty}}),t._v(" "),e("span",[t._v(t._s(a.product.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"p_quantity_"+(r+1),type:"text",name:"details["+(r+1)+"][quantity]"},domProps:{value:a.quantity},on:{change:function(e){return t.calculateAfterQty(r+1)}}}),t._v(" "),e("span",[t._v(t._s(a.product.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"60%",display:"inline-block"},attrs:{id:"p_afterQty_"+(r+1),type:"text",disabled:""},domProps:{value:a.afterQty}}),t._v(" "),e("span",[t._v(t._s(a.product.showUnit))])]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-md btn-danger",attrs:{type:"button"},on:{click:function(e){return t.deleteDetail(r)}}},[e("i",{staticClass:"far fa-trash-alt"})])])])})),0)])])])])}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("編號")]),t._v(" "),e("th",[t._v("商品")]),t._v(" "),e("th",[t._v("產前量")]),t._v(" "),e("th",[t._v("增加量")]),t._v(" "),e("th",[t._v("產後量")]),t._v(" "),e("th",[t._v("操作")])])])}],!1,null,null,null);e.default=s.exports}});