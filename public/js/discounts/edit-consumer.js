!function(t){var e={};function r(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=147)}({0:function(t,e,r){"use strict";function o(t,e,r,o,i,s,n,a){var c,d="function"==typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=r,d._compiled=!0),o&&(d.functional=!0),s&&(d._scopeId="data-v-"+s),n?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},d._ssrRegister=c):i&&(c=a?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),c)if(d.functional){d._injectStyles=c;var u=d.render;d.render=function(t,e){return c.call(e),u(t,e)}}else{var l=d.beforeCreate;d.beforeCreate=l?[].concat(l,c):[c]}return{exports:t,options:d}}r.d(e,"a",(function(){return o}))},147:function(t,e,r){t.exports=r(148)},148:function(t,e,r){Vue.component("consumer-discounts",r(217).default);new Vue({el:"#discounts",data:function(){return{products:[],all_products:[],products_disabled:[],original_discounts:[],discounts:[]}},methods:{refreshProducts:function(t){if(this.products=this.all_products,"add"==t.type)this.products_disabled.push({id:this.products[t.id].id,name:this.products[t.id].name});else{for(var e,r=0;r<this.products_disabled.length;r++)if(this.products_disabled[r].id==t.id){e=r;break}this.products_disabled.splice(e,1)}this.products=[];for(var o=0;o<this.all_products.length;o++){for(var i=!0,s=0;s<this.products_disabled.length;s++)this.all_products[o].id==this.products_disabled[s].id&&(i=!1);i&&this.products.push(this.all_products[o])}}},created:function(){var t=this;$.showLoadingModal();var e=$("#getProductsName").html();axios.get(e).then((function(e){t.products=e.data,t.all_products=t.products;var r=$("#getDiscountsList").html();axios.get(r).then((function(e){$.closeModal(),t.original_discounts=e.data.discounts;for(var r=0;r<t.original_discounts.length;r++)t.refreshProducts({id:t.original_discounts[r].id-1,type:"add"}),t.discounts.push({count:t.discounts.length,product:{id:t.original_discounts[r].id,shownID:t.original_discounts[r].shownID,name:t.original_discounts[r].name,costprice:Math.round(1e3*t.original_discounts[r].costprice)/1e3,profit:Math.round(1e3*t.original_discounts[r].profit)/1e3,retailPrice:Math.round(1e3*t.original_discounts[r].retailPrice)/1e3,showUnit:t.original_discounts[r].showUnit},relativePrice:t.original_discounts[r].pivot.price,absolutePirce:Math.round(1e3*(t.original_discounts[r].retailPrice-t.original_discounts[r].pivot.price))/1e3})})).catch((function(t){$.showErrorModal(t),console.error("取得折扣資料時發生錯誤，訊息："+t)}))})).catch((function(t){$.showErrorModal(t),console.error("抓取商品資料時發生錯誤，訊息："+t)}))},mounted:function(){}})},217:function(t,e,r){"use strict";r.r(e);var o={props:["products","discounts"],mounted:function(){},data:function(){return{current_product:[],discountsIndex:$("#discountsIndex").html()}},methods:{addDiscount:function(){var t=$("#product_id").val();0==t?alert("請先選擇商品!"):(this.$emit("refresh-products",{id:t-1,type:"add"}),0!=this.current_product.length?this.discounts.push({count:this.discounts.length,product:{id:this.current_product.id,shownID:this.current_product.shownID,name:this.current_product.name,costprice:Math.round(1e3*this.current_product.costprice)/1e3,profit:Math.round(1e3*this.current_product.profit)/1e3,retailPrice:Math.round(1e3*this.current_product.retailPrice)/1e3,showUnit:this.current_product.showUnit},relativePrice:0,absolutePirce:this.current_product.retailPrice}):alert("請選擇商品"))},deleteDiscount:function(t){this.discounts.splice(t,1),this.$emit("refresh-product",{id:$("#productID_"+(t+1)).val(),type:"deleted"})},calculateAbsolutePirce:function(t){var e=parseFloat($("#costprice_"+t).val()),r=parseFloat($("#retailPrice_"+t).val()),o=parseFloat(Math.round(1e3*$("#relativePrice_"+t).val())/1e3),i=parseFloat(Math.round(1e3*(r-o))/1e3);i<e&&(alert("折扣價已低於成本價，這麼做會開始虧錢，無法這樣使用。"),o=0,i=r,$("#relativePrice_"+t).val(0),$("#absolutePirce_"+t).val(i)),this.discounts[t-1].relativePrice=o,this.discounts[t-1].absolutePirce=i},calculateRelativePrice:function(t){var e=parseFloat($("#costprice_"+t).val()),r=parseFloat($("#retailPrice_"+t).val()),o=parseFloat(Math.round(1e3*$("#absolutePirce_"+t).val())/1e3),i=parseFloat(Math.round(1e3*(r-o))/1e3);o<e&&(alert("折扣價已低於成本價，這麼做會開始虧錢，無法這樣使用。"),i=0,o=r,$("#relativePrice_"+t).val(0),$("#absolutePirce_"+t).val(o)),this.discounts[t-1].relativePrice=i,this.discounts[t-1].absolutePirce=o},getProductData:function(){var t=this,e=$("#product_id").val();if($.showLoadingModal(),0!=e){var r=$("#getProductInfo").html();$("#addProductBtn").attr("disabled",!0),axios.post(r,{id:e}).then((function(e){$.closeModal(),t.current_product=e.data,$("#addProductBtn").attr("disabled",!1)})).catch((function(t){console.error("抓取商品資料時發生錯誤！"),$.showErrorModal(t)}))}else alert("請選擇商品")},submitEditDisCountsForm:function(){if(0==this.discounts.length)alert("請先新增折扣商品!");else{var t=$("#editDiscountsForm").attr("action"),e=$("#editDiscountsForm").serialize();$.showLoadingModal(),axios.post(t,e).then((function(t){$.showSuccessModal(t.data.message,t.data.url)})).catch((function(t){console.error("編輯折扣時發生錯誤，錯誤訊息："+t),$.showErrorModal(t)}))}}}},i=r(0),s=Object(i.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"row justify-content-center"},[e("div",{staticClass:"col-md-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-6 mb-2"},[e("select",{staticClass:"form-control",attrs:{id:"product_id"},on:{change:t.getProductData}},[e("option",{attrs:{value:"0"}},[t._v("請選擇...")]),t._v(" "),t._l(t.products,(function(r){return e("option",{domProps:{value:r.id}},[t._v(t._s(r.name))])}))],2)]),t._v(" "),e("div",{staticClass:"col-md-6"},[e("button",{staticClass:"btn btn-md btn-success",attrs:{id:"addProductBtn",type:"button"},on:{click:t.addDiscount}},[t._v("新增折扣")])])]),t._v(" "),e("form",{attrs:{id:"editDiscountsForm",method:"POST",action:"#"},on:{submit:function(e){return e.preventDefault(),t.submitEditDisCountsForm.apply(null,arguments)}}},[e("table",{staticClass:"table table-bordered",attrs:{width:"100%",cellspacing:"0"}},[t._m(0),t._v(" "),e("tbody",t._l(t.discounts,(function(r,o){return e("tr",{key:o},[e("td",[t._v(t._s(r.product.shownID))]),t._v(" "),e("td",[t._v("\r\n                            "+t._s(r.product.name)+"\r\n                            "),e("input",{attrs:{type:"hidden",name:"discounts["+(o+1)+"][product_id]"},domProps:{value:r.product.id}})]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"50%",display:"inline-block"},attrs:{id:"costprice_"+(o+1),type:"text",disabled:""},domProps:{value:r.product.costprice}}),t._v(" "),e("span",[t._v(" 元 / "+t._s(r.product.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control mr-2",staticStyle:{width:"50%",display:"inline-block"},attrs:{id:"retailPrice_"+(o+1),type:"text",disabled:""},domProps:{value:r.product.retailPrice}}),t._v(" "),e("span",[t._v(" 元 / "+t._s(r.product.showUnit))])]),t._v(" "),e("td",[e("input",{staticClass:"form-control",attrs:{id:"relativePrice_"+(o+1),type:"text",name:"discounts["+(o+1)+"][relativePrice]"},domProps:{value:r.relativePrice},on:{change:function(e){return t.calculateAbsolutePirce(o+1)}}})]),t._v(" "),e("td",[e("input",{staticClass:"form-control",attrs:{id:"absolutePirce_"+(o+1),type:"text",name:"discounts["+(o+1)+"][absolutePirce]"},domProps:{value:r.absolutePirce},on:{change:function(e){return t.calculateRelativePrice(o+1)}}})]),t._v(" "),e("td",[e("button",{staticClass:"btn btn-md btn-danger",attrs:{type:"button"},on:{click:function(e){return t.deleteDiscount(o)}}},[e("i",{staticClass:"far fa-trash-alt"})])])])})),0)]),t._v(" "),e("div",{staticClass:"form-group row justify-content-center"},[e("div",{staticClass:"col-md-8"},[e("button",{staticClass:"btn btn-block btn-primary",attrs:{type:"submit"}},[t._v("\r\n                        確認儲存\r\n                    ")]),t._v(" "),e("a",{staticClass:"btn btn-block btn-danger",attrs:{href:t.discountsIndex}},[t._v("\r\n                        返回列表\r\n                    ")])])])])])])}),[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("編號")]),t._v(" "),e("th",[t._v("商品名稱")]),t._v(" "),e("th",[t._v("成本價")]),t._v(" "),e("th",[t._v("零售價")]),t._v(" "),e("th",[t._v("相對價格")]),t._v(" "),e("th",[t._v("絕對價格")]),t._v(" "),e("th",[t._v("操作")])])])}],!1,null,null,null);e.default=s.exports}});